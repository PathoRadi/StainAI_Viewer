{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>STAIN.AI VIEWER</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="{% static 'css/mainContainer.css' %}">
  <link rel="stylesheet" href="{% static 'css/leftContainer.css' %}">
  <link rel="stylesheet" href="{% static 'css/progress.css' %}">
  <link rel="stylesheet" href="{% static 'css/homePage.css' %}">
  <link rel="stylesheet" href="{% static 'css/history.css' %}">
  <link rel="stylesheet" href="{% static 'css/roi.css' %}">
  <link rel="stylesheet" href="{% static 'css/visualization.css' %}">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://openseadragon.github.io/openseadragon/openseadragon.min.js"></script>
  <script src="https://openseadragon.github.io/svg-overlay/openseadragon-svg-overlay.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/konva@9.2.0/konva.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.7.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
</head>

<body>
  <!-- â”€â”€â”€â”€â”€ Left container â”€â”€â”€â”€â”€ -->
  <div class="left-container">
    <!-- Left Container Upper Part -->
    <div class="left-container-header">
      <!-- Title & Logo -->
      <div class="logo-container">
        <img class="app-logo logo-dark" src="{% static 'logo/konva_control/logo_dark.png' %}">
        <img class="app-logo logo-light" src="{% static 'logo/konva_control/logo_light.png' %}">
      </div>
      <!-- Upload New Images -->
      <button id="upload-new-img-btn">+ MORE IMAGE</button>
      <!-- UPLOAD & HISTORY PANEL -->
      <div id="upload-panel">
        <div id="history-container"></div>
      </div>
    </div>
    <!-- Left Container Lowwer Part -->
    <div class="left-container-bottom">
      <!-- ReadMe -->
      <button class="readme-btn">
        <img class="readme-btn-icon" src="{% static 'logo/readme_icon.png' %}">
      </button>
      <!-- Dark/Light Mode Toggle -->
      <div class="theme-toggle-wrapper">
        <span id="theme-mode-text">Dark Mode</span>
        <label class="theme-switch">
          <input type="checkbox" id="theme-toggle" />
          <span class="slider">
          </span>
        </label>
      </div>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€ Read Me Page â”€â”€â”€â”€â”€ -->
  <div id="readme-page" class="readme-overlay" hidden>
    <div class="readme-header">
      <button id="readme-popout-btn">ðŸ——</button>
      <button id="readme-close-btn">âœ•</button>
    </div>
    <div class="readme-box">
      <!-- <img src="{% static 'logo/readme_page.png' %}" class="readme-content"> -->
      <iframe id="readme-iframe" src=""></iframe>
    </div>
  </div>


  <!-- â”€â”€â”€â”€â”€ Drag & Drop / Click Upload Area â”€â”€â”€â”€â”€ -->
  <div id="drop-zone">
    <p>Drag &amp; Drop Image Here</p>
    <button id="drop-upload-btn">Or Click to Upload</button>
    <input type="file" id="drop-upload-input" accept="image/*" style="display:none" />

    <!-- â”€â”€â”€ Preview + Start Button (hidden until upload) â”€â”€â”€ -->
    <div id="preview-container">
      <img id="preview-img"
          src="" 
          alt="Uploaded preview"/>
      <button id="start-detect-btn">
        Start Detection
      </button>
    </div>
  </div>


  <!-- â”€â”€â”€â”€â”€ PROGRESS OVERLAY â”€â”€â”€â”€â”€ -->
  <div id="progress-overlay">
    <div class="stage-timeline" id="stage-timeline">
      <div class="stage-track"></div>
      <div class="stage-node" data-stage="1">
        <div class="stage-name">0%</div>
      </div>
      <div class="stage-node" data-stage="2">
        <div class="stage-name">25%</div>
      </div>
      <div class="stage-node" data-stage="3">
        <div class="stage-name">50%</div>
      </div>
      <div class="stage-node" data-stage="4">
        <div class="stage-name">75%</div>
      </div>
      <div class="stage-node" data-stage="5">
        <div class="stage-name">100%</div>
      </div>
      <img class="stage-icon" id="stage-icon" src="{% static 'logo/animation.png' %}" alt="">
    </div>
  </div>
  <div id="progress-overlay1">
    <div class="progress-text">Loading...</div>
  </div>

  <!-- â”€â”€â”€â”€â”€ MAIN PART â”€â”€â”€â”€â”€ -->
  <div class="main-container" hidden>
    <!-- Right Container -->
    <div class="right-container">
      <!-- Image -->
      <div class="visualization-container" id="image-container">
        <!-- Box ROI Controls -->
        <div class="roi-toolbar-container">
          <!-- ROI Controls -->
          <div class="konva-controls">
            <!-- Zoom In Btn -->
            <button id="zoom-in-btn" class="tooltip-parent">
              <img class="zoom-icon logo-dark" src="{% static 'logo/konva_control/zoom_in_icon_b.png' %}">
              <img class="zoom-icon logo-light" src="{% static 'logo/konva_control/zoom_in_icon_w.png' %}">
              <span class="tooltip-text">Zoom In</span>
            </button>
            <!-- Zoom Out Btn -->
            <button id="zoom-out-btn" class="tooltip-parent">
              <img class="zoom-icon logo-dark" src="{% static 'logo/konva_control/zoom_out_icon_b.png' %}">
              <img class="zoom-icon logo-light" src="{% static 'logo/konva_control/zoom_out_icon_w.png' %}">
              <span class="tooltip-text">Zoom Out</span>
            </button>
            <!-- Reset Zoom Level Btn -->
            <button id="zoom-home-btn" class="tooltip-parent">
              <img class="zoom-icon logo-dark" src="{% static 'logo/konva_control/home_icon_b.png' %}">
              <img class="zoom-icon logo-light" src="{% static 'logo/konva_control/home_icon_w.png' %}">
              <span class="tooltip-text">Reset Zoom Level</span>
            </button>
            <!-- Drag Btn -->
            <button id="non-draw-btn" class="active tooltip-parent">
              <img class="non-draw-icon logo-dark" src="{% static 'logo/konva_control/drag_icon_b_on.png' %}">
              <img class="non-draw-icon logo-light" src="{% static 'logo/konva_control/drag_icon_w_on.png' %}">
              <span class="tooltip-text">Drag</span>
            </button>
            <!-- Polygon Drawing Btn -->
            <button id="polygon-draw-btn" class="tooltip-parent">
              <img class="polygon-icon logo-dark" src="{% static 'logo/konva_control/polygon_icon_b_on.png' %}">
              <img class="polygon-icon logo-light" src="{% static 'logo/konva_control/polygon_icon_w_on.png' %}">
              <span class="tooltip-text">Polygon ROI</span>
            </button>
            <!-- Freehand Drawing Btn -->
            <button id="freehand-draw-btn" class="tooltip-parent">
              <img class="freehand-icon logo-dark" src="{% static 'logo/konva_control/freehand_icon_b_on.png'  %}">
              <img class="freehand-icon logo-light" src="{% static 'logo/konva_control/freehand_icon_w_on.png'  %}">
              <span class="tooltip-text">Freehand ROI</span>
            </button>
            <!-- Show All ROI Btn -->
            <button id="show-all-roi-btn" class="tooltip-parent">
              <!-- dark -->
              <img class="show-all-roi-icon logo-dark" src="{% static 'logo/konva_control/show_roi_icon_b_on.png' %}">
              <!-- light -->
              <img class="show-all-roi-icon logo-light" src="{% static 'logo/konva_control/show_roi_icon_w_on.png' %}">
              <span class="tooltip-text">Show/Hide All ROI</span>
            </button>
            <!-- Clear Draw Btn -->
            <button id="clear-draw-btn" class="tooltip-parent">
              <img class="clear-icon logo-dark" src="{% static 'logo/konva_control/clear_icon_b.png' %}">
              <img class="clear-icon logo-light" src="{% static 'logo/konva_control/clear_icon_w.png' %}">
              <span class="tooltip-text">Clear ROI</span>
            </button>
            <!-- ROI Color Picker -->
            <div class="color-picker-wrapper tooltip-parent">
              <input type="color" id="color-picker" value="#ff0000"/>
              <label for="color-picker" class="color-picker-icon">
                <img class="logo-dark" src="{% static 'logo/konva_control/color_icon_b.png' %}">
                <img class="logo-light" src="{% static 'logo/konva_control/color_icon_w.png' %}">
              </label>
              <span class="tooltip-text">ROI Color</span>
            </div>
          </div>
          <!-- Box Controls -->
          <div class="checkbox-container-wrapper">
            <text class="checkbox-label">CLASS TO DISPLAY</text>
            <div class="checkbox-container">
              <input type="checkbox" id="Checkbox_R" class="hidden-checkbox">
              <label for="Checkbox_R" class="checkbox-icon-label tooltip-parent">
                <img src="{% static 'logo/R_icon_on.png' %}" class="checkbox-icon icon-checked">
                <img src="{% static 'logo/R_icon_off.png' %}" class="checkbox-icon icon-unchecked">
                <span class="tooltip-text">Ramified</span>
              </label>
              <input type="checkbox" id="Checkbox_H" class="hidden-checkbox">
              <label for="Checkbox_H" class="checkbox-icon-label tooltip-parent">
                <img src="{% static 'logo/H_icon_on.png' %}" class="checkbox-icon icon-checked">
                <img src="{% static 'logo/H_icon_off.png' %}" class="checkbox-icon icon-unchecked">
                <span class="tooltip-text">Hypertrophic</span>
              </label>
              <input type="checkbox" id="Checkbox_B" class="hidden-checkbox">
              <label for="Checkbox_B" class="checkbox-icon-label tooltip-parent">
                <img src="{% static 'logo/B_icon_on.png' %}" class="checkbox-icon icon-checked">
                <img src="{% static 'logo/B_icon_off.png' %}" class="checkbox-icon icon-unchecked">
                <span class="tooltip-text">Bushy</span>
              </label>
              <input type="checkbox" id="Checkbox_A" class="hidden-checkbox">
              <label for="Checkbox_A" class="checkbox-icon-label tooltip-parent">
                <img src="{% static 'logo/A_icon_on.png' %}" class="checkbox-icon icon-checked">
                <img src="{% static 'logo/A_icon_off.png' %}" class="checkbox-icon icon-unchecked">
                <span class="tooltip-text">Amoeboid</span>
              </label>
              <input type="checkbox" id="Checkbox_RD" class="hidden-checkbox">
              <label for="Checkbox_RD" class="checkbox-icon-label tooltip-parent">
                <img src="{% static 'logo/RD_icon_on.png' %}" class="checkbox-icon icon-checked">
                <img src="{% static 'logo/RD_icon_off.png' %}" class="checkbox-icon icon-unchecked">
                <span class="tooltip-text">Rod</span>
              </label>
              <input type="checkbox" id="Checkbox_HR" class="hidden-checkbox">
              <label for="Checkbox_HR" class="checkbox-icon-label tooltip-parent">
                <img src="{% static 'logo/HR_icon_on.png' %}" class="checkbox-icon icon-checked">
                <img src="{% static 'logo/HR_icon_off.png' %}" class="checkbox-icon icon-unchecked">
                <span class="tooltip-text">Hyper-Rod</span>
              </label>
              <input type="checkbox" id="checkbox_All" class="hidden-checkbox">
              <label for="checkbox_All" class="checkbox-icon-label tooltip-parent">
                <img src="{% static 'logo/all_icon_on.png' %}" class="checkbox-icon icon-checked">
                <img src="{% static 'logo/all_icon_off.png' %}" class="checkbox-icon icon-unchecked">
                <span class="tooltip-text">Show All Classes</span>
              </label>
            </div>
          </div>
          <!-- Screen Shot Menu -->
          <div class="screenshot-menu-wrapper">
            <button class="screenshot-menu-btn" id="screenshot-menu-btn0">â‹¯</button>
            <div class="screenshot-dropdown" id="screenshot-dropdown0">
              <button class="take-screenshot-btn" id="take-screenshot-btn0">Save Image</button>
            </div>
          </div>
        </div>
        <!-- Image Display -->
        <div id="displayedImage-wrapper">
          <!-- Image -->
          <div id="displayedImage"></div>
          <!-- The Layer That Contains ROI -->
          <div id="konva-container"></div>
        </div>
      </div>
      <!-- Chart -->
      <div class="visualization-container" id="chart-container">
        <div class="button-container">
          <!-- addChartBtn -->
          <button id="addChartBtn">+ CHART</button>
        </div>
        <!-- Bar Chart -->
        <div id="barChart-wrappers">
        </div>
        <div id="barChart-wrappers1">
        </div>
      </div>
    </div>
    <!-- Pop out window whether to delete the image -->
    <div id="delete-modal-overlay" class="modal-overlay" hidden>
      <div class="modal-box">
        <p>Delete Project?</p>
        <div class="modal-actions">
          <button id="modal-cancel">Cancel</button>
          <button id="modal-delete">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const UPLOAD_IMAGE_URL   = "{% url 'myapp:upload_image' %}";
    const DETECT_IMAGE_URL   = "{% url 'myapp:detect_image' %}";
    const DELETE_PROJECT_URL = "{% url 'myapp:delete_project' %}";
    const DOWNLOAD_PROJECT_URL= "{% url 'myapp:download_project' %}";
    const DOWNLOAD_WITH_ROIS_URL = "{% url 'myapp:download_with_rois' %}";
    const PROGRESS_URL       = "{% url 'myapp:progress' %}";
    window.addEventListener('beforeunload', () => {
      navigator.sendBeacon("{% url 'myapp:reset_media' %}");
    });
  </script>
  <script type="module" src="{% static 'script/script.js' %}"></script>
</body>
</html>